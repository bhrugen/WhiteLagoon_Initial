@using WhiteLagoon.Helper;

<div class="card">
    <div class="card-body">
        <div>
            <p class="text-muted mb-0">New Members And Bookings In Past 30 Days</p>
        </div>

        <select class="form-select border shadow d-none" data-val="true" id="drpDays" name="days">
            <option value="30">30 Days</option>
            <option value="90">90 Days</option>
            <option value="365">1 Year</option>
        </select>

        <div class="justify-content-center text-center booking-spinner" style="display:none">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <div id="new_members_and_bookings_chart" data-colors='["--bs-primary", "--bs-warning"]'></div>

        
    </div>
</div>

@Html.PartialSectionScripts(
    @<script>
             $(document).ready(function () {
                 getMemberAndBookingChartData();
             });

             document.getElementById('drpDays').addEventListener('change', function () {
                 getMemberAndBookingChartData();
             });

             function getMemberAndBookingChartData() {
                 $("#new_members_and_bookings_chart").empty();
                 $(".booking-spinner").show();
                 // Get the dynamic data from the server
                 fetch('@Url.Action("GetMemberAndBookingChartData","Dashboard")?days=' + $("#drpDays").val())
                     .then(response => response.json())
                     .then(data => {
                         loadMemberAndBookingsLineChart("new_members_and_bookings_chart", data);

                         $(".booking-spinner").hide();
                     });
             }

             // Function to load the Line chart
             function loadMemberAndBookingsLineChart(id, data) {
                 var chartColors = getChartColorsArray(id);
                 // Chart options
                 var options = {
                     colors: chartColors,
                     chart: {
                         height: 350,
                         type: 'line',
                         zoom: {
                             enabled: false
                         },
                         dropShadow: {
                             enabled: true,
                             top: 3,
                             left: 2,
                             blur: 4,
                             opacity: 1,
                         }
                     },
                     stroke: {
                         curve: 'smooth',
                         width: 2
                     },
                     series: data.series,

                     dataLabels: {
                         enabled: false,
                     },
                     markers: {
                         size: 6,
                         strokeWidth: 0,
                         hover: {
                             size: 9
                         }
                     },
                     grid: {
                         show: true,
                         padding: {
                             bottom: 0
                         }
                     },


                     xaxis: {
                         categories: data.categories,
                         labels: {
                             style: {
                                 colors: "#fff",
                             },
                         }
                     },
                     yaxis: {
                         labels: {
                             formatter: function (val) {
                                 return val.toFixed(0);
                             },
                             style: {
                                 colors: "#fff",
                             },
                         }
                     },
                     legend: {
                         position: 'bottom',
                         labels: {
                             colors: "#fff",
                             useSeriesColors: false
                         },
                     }
                 };

                 // Create the line chart
                 var chart = new ApexCharts(document.querySelector("#" + id), options);
                 chart.render();
             }
    </script>
)